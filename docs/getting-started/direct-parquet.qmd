---
title: "Direct Parquet Queries"
---

## Overview

You can query parquet files directly from R2/S3 without downloading the database file. This is useful when you only need specific tables or want more control over data access.

## Basic Query

```python
import duckdb

# Query a single parquet file
result = duckdb.execute("""
    SELECT *
    FROM read_parquet('https://store.yourdomain.com/data/bronze/stg_sra_studies.parquet')
    LIMIT 10
""").df()

print(result)
```

## Finding File URLs

File locations are documented in the [data catalog](https://store.yourdomain.com/catalog.json):

```python
import json
import requests

# Load catalog
catalog_url = "https://store.yourdomain.com/catalog.json"
catalog = requests.get(catalog_url).json()

# Find a table
for dataset in catalog.get('datasets', []):
    for table in dataset.get('tables', []):
        if table['name'] == 'stg_sra_studies':
            print(f"URL: {table['location']}")
            print(f"Schema: {table['schema']}")
```

## Querying Multiple Files

### Multiple Files with Same Schema

```python
# Query multiple parquet files
result = duckdb.execute("""
    SELECT *
    FROM read_parquet([
        'https://store.yourdomain.com/data/bronze/stg_sra_studies.parquet',
        'https://store.yourdomain.com/data/bronze/stg_sra_experiments.parquet'
    ])
""").df()
```

### Pattern Matching

```python
# Query all files matching a pattern (if supported)
result = duckdb.execute("""
    SELECT *
    FROM read_parquet('https://store.yourdomain.com/data/bronze/*.parquet')
""").df()
```

## Joining Across Files

```python
# Join data from different parquet files
result = duckdb.execute("""
    SELECT 
        s.accession as study,
        s.title,
        COUNT(e.accession) as experiment_count
    FROM read_parquet('https://store.yourdomain.com/data/bronze/stg_sra_studies.parquet') s
    LEFT JOIN read_parquet('https://store.yourdomain.com/data/bronze/stg_sra_experiments.parquet') e
        ON s.accession = e.study_accession
    GROUP BY s.accession, s.title
    ORDER BY experiment_count DESC
    LIMIT 10
""").df()

print(result)
```

## Performance Considerations

1. **Column Selection**: Only select columns you need
   ```python
   # Good - only selected columns
   SELECT accession, title 
   FROM read_parquet('...')
   
   # Less efficient - all columns
   SELECT * 
   FROM read_parquet('...')
   ```

2. **Filtering**: Apply filters to reduce data transfer
   ```python
   SELECT *
   FROM read_parquet('...')
   WHERE organism = 'Homo sapiens'
   LIMIT 100
   ```

3. **Caching**: DuckDB can cache parquet files locally for faster subsequent queries

## When to Use Direct Parquet vs Database

**Use Direct Parquet when:**
- You only need specific tables
- You want to query files from different sources
- You're building custom data pipelines

**Use Remote Database when:**
- You want the convenience of pre-configured views
- You're exploring multiple tables
- You want schema information readily available

## Example: Complete Workflow

```python
import duckdb

# Query SRA studies
studies = duckdb.execute("""
    SELECT 
        accession,
        title,
        organism,
        publish_date
    FROM read_parquet('https://store.yourdomain.com/data/bronze/stg_sra_studies.parquet')
    WHERE organism = 'Homo sapiens'
    AND publish_date >= '2024-01-01'
    ORDER BY publish_date DESC
    LIMIT 100
""").df()

print(f"Found {len(studies)} studies")

# Now join with experiments if needed
experiments = duckdb.execute("""
    SELECT 
        s.accession as study,
        COUNT(e.accession) as exp_count
    FROM read_parquet('https://store.yourdomain.com/data/bronze/stg_sra_studies.parquet') s
    LEFT JOIN read_parquet('https://store.yourdomain.com/data/bronze/stg_sra_experiments.parquet') e
        ON s.accession = e.study_accession
    WHERE s.organism = 'Homo sapiens'
    GROUP BY s.accession
""").df()

print(experiments)
```

## Next Steps

- [Using the Remote Database](remote-database.qmd) - Alternative access method
- [Example Queries](../examples/common-queries.ipynb) - More examples
- [Data Catalog](../data-catalog/overview.qmd) - Find file locations

